<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Gold Price Editor - Bhima Jewellery</title>
    
    <!-- Shopify App Bridge (for embedded apps) -->
    <script src="https://unpkg.com/@shopify/app-bridge@3"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div id="root"></div>

    <!-- API Utilities (must load first) -->
    <script src="/js/utils/api.js"></script>
    
    <!-- Load and process all components with Babel -->
    <script>
        const { useState, useEffect } = React;
        
        // Function to load and execute a script with Babel
        async function loadBabelScript(url) {
            const response = await fetch(url);
            const code = await response.text();
            const transformed = Babel.transform(code, {
                presets: ['react']
            }).code;
            eval(transformed);
        }
        
        // Load all scripts in order
        async function loadAllScripts() {
            try {
                // Load components
                await loadBabelScript('/js/components/DashboardTab.js');
                await loadBabelScript('/js/components/ProductsTab.js');
                await loadBabelScript('/js/components/ProductConfigModal.js');
                await loadBabelScript('/js/components/StoneModal.js');
                await loadBabelScript('/js/components/DiscountsTab.js');
                await loadBabelScript('/js/components/DiscountFormModal.js');
                await loadBabelScript('/js/components/ProductSelector.js');
                await loadBabelScript('/js/components/ConflictResolutionModal.js');
                await loadBabelScript('/js/components/RefreshProgressModal.js');
                await loadBabelScript('/js/components/ConfirmModal.js');
                
                // Load main app
                await loadBabelScript('/js/app.js');
                
                // Initialize app
                if (window.App && window.API) {
                    console.log('All components loaded:', {
                        App: !!window.App,
                        API: !!window.API,
                        RefreshProgressModal: !!window.RefreshProgressModal,
                        ConfirmModal: !!window.ConfirmModal,
                        DashboardTab: !!window.DashboardTab
                    });
                    ReactDOM.render(React.createElement(window.App), document.getElementById('root'));
                } else {
                    console.error('App or API not loaded. App:', !!window.App, 'API:', !!window.API);
                }
            } catch (error) {
                console.error('Error loading scripts:', error);
            }
        }
        
        // Start loading when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAllScripts);
        } else {
            loadAllScripts();
        }
    </script>
</body>
</html>
