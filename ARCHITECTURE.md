# ğŸ—ï¸ System Architecture & Flow Diagrams

## Overview

The Jewelry Live Price Editor is a complete automated pricing system that integrates with Shopify to manage product prices based on fluctuating metal rates.

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SHOPIFY ADMIN                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Products   â”‚  â”‚  Metaobjects â”‚  â”‚  Metafields  â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ - Variants   â”‚  â”‚ - Metal      â”‚  â”‚ - Product    â”‚          â”‚
â”‚  â”‚ - Prices     â”‚  â”‚   Prices     â”‚  â”‚   Config     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Shopify Admin GraphQL API
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JEWELRY PRICE APP SERVER                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Express.js API Server                   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚   Routes     â”‚  â”‚   Business   â”‚  â”‚   Utilities  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚    Logic     â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Metal      â”‚  â”‚              â”‚  â”‚ - Price      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   Prices     â”‚  â”‚ - Calculate  â”‚  â”‚   Calculator â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Products   â”‚  â”‚ - Validate   â”‚  â”‚ - Shopify    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Stone      â”‚  â”‚ - Transform  â”‚  â”‚   API Client â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   Prices     â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Static File Server                      â”‚  â”‚
â”‚  â”‚                 (Serves React Admin UI)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP REST API
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADMIN WEB INTERFACE                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 React Single Page App                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Dashboard   â”‚  â”‚   Products   â”‚  â”‚   Settings   â”‚   â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Metal      â”‚  â”‚ - List       â”‚  â”‚ - App Config â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   Prices     â”‚  â”‚ - Configure  â”‚  â”‚ - Stone      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Stone      â”‚  â”‚ - Calculate  â”‚  â”‚   Pricing    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚   Prices     â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Refresh    â”‚  â”‚              â”‚  â”‚              â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚                    Accessed via Browser                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagrams

### 1. Updating Metal Prices Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Admin     â”‚
â”‚    Opens     â”‚
â”‚  Dashboard   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Enters New      â”‚
â”‚  Metal Prices    â”‚
â”‚                  â”‚
â”‚ - Gold 24K: 7000 â”‚
â”‚ - Gold 22K: 6500 â”‚
â”‚ - Silver: 80     â”‚
â”‚ etc...           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clicks Update Button  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/metal-prices          â”‚
â”‚  {                                â”‚
â”‚    gold24kt: 7000,               â”‚
â”‚    gold22kt: 6500,               â”‚
â”‚    ...                            â”‚
â”‚  }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Validates Data             â”‚
â”‚  - Check all fields present        â”‚
â”‚  - Ensure valid numbers            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Shopify Metaobject             â”‚
â”‚  GraphQL Mutation:                     â”‚
â”‚  metaobjectUpsert(                     â”‚
â”‚    type: "metal_prices"                â”‚
â”‚    handle: "current_rates"             â”‚
â”‚    fields: [...]                       â”‚
â”‚  )                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update In-Memory Calculator       â”‚
â”‚  priceCalculator.updateRates(...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success Response      â”‚
â”‚  Show Success Message  â”‚
â”‚  "Prices Updated!"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Configuring Product Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Admin     â”‚
â”‚ Opens Productâ”‚
â”‚  in Products â”‚
â”‚     Tab      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clicks "Edit" Button   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/products/:id        â”‚
â”‚  Fetch existing configuration â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configuration Modal Opens        â”‚
â”‚  Pre-filled with existing data    â”‚
â”‚  (if configured before)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Enters/Updates:             â”‚
â”‚  - Metal Weight: 4.54g             â”‚
â”‚  - Metal Type: Gold 22K            â”‚
â”‚  - Making Charge: 10%              â”‚
â”‚  - Labour: 5% (percentage)         â”‚
â”‚  - Wastage: 3% (percentage)        â”‚
â”‚  - Stone Cost: â‚¹160                â”‚
â”‚  - Tax: 3%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ (Real-time on every change)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/calculate-price         â”‚
â”‚  Calculate preview (no save)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Price Breakdown Displayed:        â”‚
â”‚  - Metal Cost: â‚¹29,510             â”‚
â”‚  - Making: â‚¹2,951                  â”‚
â”‚  - Labour: â‚¹1,475.50               â”‚
â”‚  - Wastage: â‚¹885.30                â”‚
â”‚  - Stone: â‚¹160                     â”‚
â”‚  - Tax: â‚¹1,049.45                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚  Final: â‚¹36,031.25                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Admin reviews and confirms
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clicks "Done" Button              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/products/:id/configure  â”‚
â”‚  Save configuration                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server:                           â”‚
â”‚  1. Validate all fields            â”‚
â”‚  2. Calculate final price          â”‚
â”‚  3. Save to product metafields     â”‚
â”‚  4. Update product variant price   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GraphQL Mutations:                â”‚
â”‚                                    â”‚
â”‚  1. metafieldsSet(                 â”‚
â”‚       ownerId: productId           â”‚
â”‚       namespace: "jewelry_config"  â”‚
â”‚       fields: [...]                â”‚
â”‚     )                               â”‚
â”‚                                    â”‚
â”‚  2. productVariantUpdate(          â”‚
â”‚       id: variantId                â”‚
â”‚       price: "36031.25"            â”‚
â”‚     )                               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success!              â”‚
â”‚  Product Configured    â”‚
â”‚  Price Updated in      â”‚
â”‚  Shopify Store         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Bulk Price Refresh Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Admin     â”‚
â”‚   Updates    â”‚
â”‚ Metal Prices â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clicks "Refresh Prices"  â”‚
â”‚  Button in Dashboard      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Confirmation Dialog       â”‚
â”‚  "Update all products?"    â”‚
â”‚  [Cancel] [OK]             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Admin confirms
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/refresh-prices    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Workflow:                    â”‚
â”‚                                      â”‚
â”‚  1. Get current metal rates          â”‚
â”‚     (from in-memory calculator)      â”‚
â”‚                                      â”‚
â”‚  2. Fetch ALL configured products    â”‚
â”‚     (query metafields filter)        â”‚
â”‚                                      â”‚
â”‚  3. For each product:                â”‚
â”‚     â”œâ”€ Get configuration             â”‚
â”‚     â”œâ”€ Calculate new price           â”‚
â”‚     â”œâ”€ Update variant price          â”‚
â”‚     â””â”€ Track success/failure         â”‚
â”‚                                      â”‚
â”‚  4. Collect results                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Example Processing:                 â”‚
â”‚                                      â”‚
â”‚  Product 1: "22K Gold Ring"          â”‚
â”‚    Config: 4.54g, 22K, 10% making... â”‚
â”‚    Old Price: â‚¹35,000                â”‚
â”‚    New Price: â‚¹36,031.25 âœ“           â”‚
â”‚                                      â”‚
â”‚  Product 2: "Gold Necklace"          â”‚
â”‚    Config: 15.2g, 22K, 12% making... â”‚
â”‚    Old Price: â‚¹115,000               â”‚
â”‚    New Price: â‚¹121,545.80 âœ“          â”‚
â”‚                                      â”‚
â”‚  Product 3: "Silver Bracelet"        â”‚
â”‚    Config: 25g, Silver, 8% making... â”‚
â”‚    Old Price: â‚¹2,500                 â”‚
â”‚    New Price: â‚¹2,592.00 âœ“            â”‚
â”‚                                      â”‚
â”‚  ... (continues for all products)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response to Admin:                  â”‚
â”‚                                      â”‚
â”‚  Success: 47 products updated        â”‚
â”‚  Failed: 0 products                  â”‚
â”‚                                      â”‚
â”‚  Detailed Report:                    â”‚
â”‚  [View full update log]              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  All prices updated!   â”‚
â”‚  Customers see new     â”‚
â”‚  prices immediately    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Price Calculation Logic

```
INPUT:
â”œâ”€ metalWeight: 4.54 (grams)
â”œâ”€ metalType: "gold22kt"
â”œâ”€ makingChargePercent: 10
â”œâ”€ labourType: "percentage"
â”œâ”€ labourValue: 5
â”œâ”€ wastageType: "percentage"
â”œâ”€ wastageValue: 3
â”œâ”€ stoneCost: 160 (INR)
â””â”€ taxPercent: 3

PROCESSING:

Step 1: Get Metal Rate
metalRate = metalRates["gold22kt"] = 6500 INR/gram

Step 2: Calculate Metal Cost
metalCost = metalWeight Ã— metalRate
metalCost = 4.54 Ã— 6500 = 29,510 INR

Step 3: Calculate Making Charge
makingCharge = metalCost Ã— (makingChargePercent / 100)
makingCharge = 29,510 Ã— (10 / 100) = 2,951 INR

Step 4: Calculate Labour Charge
if (labourType === "percentage"):
  labourCharge = metalCost Ã— (labourValue / 100)
  labourCharge = 29,510 Ã— (5 / 100) = 1,475.50 INR
else if (labourType === "fixed"):
  labourCharge = labourValue

Step 5: Calculate Wastage Charge
if (wastageType === "percentage"):
  wastageCharge = metalCost Ã— (wastageValue / 100)
  wastageCharge = 29,510 Ã— (3 / 100) = 885.30 INR
else if (wastageType === "fixed"):
  wastageCharge = wastageValue
else if (wastageType === "weight"):
  wastageCharge = wastageValue Ã— metalRate

Step 6: Calculate Subtotal
subtotal = metalCost + makingCharge + labourCharge + wastageCharge + stoneCost
subtotal = 29,510 + 2,951 + 1,475.50 + 885.30 + 160 = 34,981.80 INR

Step 7: Calculate Tax
taxAmount = subtotal Ã— (taxPercent / 100)
taxAmount = 34,981.80 Ã— (3 / 100) = 1,049.45 INR

Step 8: Calculate Final Price
finalPrice = subtotal + taxAmount
finalPrice = 34,981.80 + 1,049.45 = 36,031.25 INR

OUTPUT:
{
  metalCost: 29510.00,
  makingCharge: 2951.00,
  labourCharge: 1475.50,
  wastageCharge: 885.30,
  stoneCost: 160.00,
  subtotal: 34981.80,
  taxAmount: 1049.45,
  finalPrice: 36031.25
}
```

## Data Storage Structure

### Shopify Metaobjects

**Metal Prices** (type: `metal_prices`)
```json
{
  "handle": "current_rates",
  "fields": {
    "gold_24kt": 7000,
    "gold_22kt": 6500,
    "gold_18kt": 5500,
    "gold_14kt": 4500,
    "platinum": 3000,
    "silver": 80,
    "last_updated": "2024-11-16T10:30:00Z"
  }
}
```

**Stone Pricing** (type: `stone_pricing`)
```json
{
  "handle": "vvs_1",
  "fields": {
    "stone_id": "VVS 1",
    "stone_type": "Diamond",
    "title": "DIAMOND",
    "clarity": "VVS1",
    "color": "D",
    "shape": "Round",
    "slabs": [
      {
        "fromWeight": 0,
        "toWeight": 0.5,
        "pricePerCarat": 50000
      },
      {
        "fromWeight": 0.5,
        "toWeight": 1.0,
        "pricePerCarat": 75000
      }
    ]
  }
}
```

### Product Metafields

**Namespace:** `jewelry_config`

```json
{
  "metal_weight": 4.54,
  "metal_type": "gold22kt",
  "making_charge_percent": 10,
  "labour_type": "percentage",
  "labour_value": 5,
  "wastage_type": "percentage",
  "wastage_value": 3,
  "stone_cost": 160,
  "tax_percent": 3,
  "configured": true
}
```

## Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FRONTEND                  â”‚
â”‚                                     â”‚
â”‚  - HTML5                            â”‚
â”‚  - React 18 (vanilla, no build)     â”‚
â”‚  - CSS3 (custom styling)            â”‚
â”‚  - Fetch API for HTTP requests      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKEND                   â”‚
â”‚                                     â”‚
â”‚  - Node.js 18+                      â”‚
â”‚  - Express.js 4                     â”‚
â”‚  - GraphQL (Shopify Admin API)      â”‚
â”‚  - dotenv (environment config)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DATA STORAGE                â”‚
â”‚                                     â”‚
â”‚  - Shopify Metaobjects              â”‚
â”‚  - Shopify Product Metafields       â”‚
â”‚  - In-memory cache (server-side)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DEPLOYMENT                  â”‚
â”‚                                     â”‚
â”‚  - Render.com (recommended)         â”‚
â”‚  - Heroku                           â”‚
â”‚  - VPS (DigitalOcean, AWS)          â”‚
â”‚  - Vercel (alternative)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         SECURITY LAYERS                 â”‚
â”‚                                         â”‚
â”‚  1. Environment Variables               â”‚
â”‚     - API keys never in code            â”‚
â”‚     - .env file in .gitignore           â”‚
â”‚                                         â”‚
â”‚  2. HTTPS/TLS                           â”‚
â”‚     - All traffic encrypted             â”‚
â”‚     - SSL certificates (Let's Encrypt)  â”‚
â”‚                                         â”‚
â”‚  3. Shopify Authentication              â”‚
â”‚     - Admin API access token            â”‚
â”‚     - Scoped permissions                â”‚
â”‚                                         â”‚
â”‚  4. CORS Configuration                  â”‚
â”‚     - Restrict allowed origins          â”‚
â”‚                                         â”‚
â”‚  5. Input Validation                    â”‚
â”‚     - Sanitize all user inputs          â”‚
â”‚     - Type checking                     â”‚
â”‚                                         â”‚
â”‚  6. Rate Limiting                       â”‚
â”‚     - Prevent API abuse                 â”‚
â”‚     - Respect Shopify limits            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Performance Considerations

**Caching Strategy:**
- Metal prices cached in-memory (5 min TTL)
- Product list cached (avoid repeated queries)
- GraphQL field selection optimized

**Batch Operations:**
- Bulk updates use parallel processing
- Error handling for partial failures
- Progress tracking for long operations

**API Optimization:**
- Minimal GraphQL queries
- Field selection (only needed fields)
- Pagination for large datasets

## Scalability

**Current Capacity:**
- Handles ~1000 products efficiently
- ~10 concurrent admin users
- Updates complete in ~30 seconds

**Scaling Options:**
1. **Horizontal:** Add more server instances
2. **Vertical:** Upgrade server resources
3. **Caching:** Redis for distributed cache
4. **Queue:** Bull/Redis for background jobs
5. **CDN:** CloudFlare for static assets

## Monitoring & Logging

```
Application Logs:
â”œâ”€ Server startup/shutdown
â”œâ”€ API requests/responses
â”œâ”€ Error tracking
â”œâ”€ Price update events
â””â”€ Configuration changes

Metrics to Track:
â”œâ”€ Response times
â”œâ”€ Error rates
â”œâ”€ API usage
â”œâ”€ Active products
â””â”€ Update frequency
```

---

**This architecture provides:**
âœ… Reliability  
âœ… Scalability  
âœ… Maintainability  
âœ… Security  
âœ… Performance  

Ready for production use! ğŸš€
